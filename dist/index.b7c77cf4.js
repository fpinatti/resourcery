document.addEventListener("DOMContentLoaded",(()=>{let e,t;const n=document.querySelector(".modal-body");let r="";const o={id:"",name:""},s=t=>{t||(t="fe");const n=new Request(`https://resourcery.vercel.app/feed-${t}.json`);fetch(n,{method:"GET"}).then((e=>e.json())).then((t=>{(t=>{const n=document.querySelector(".posts__list"),r=document.querySelector(".post-template");e=t,t.forEach(((e,t)=>{e["content:encoded"]||(e["content:encoded"]=e.description);const o=r.content.cloneNode(!0);o.querySelector(".post__title").innerText=e.title,o.querySelector(".post__provider").innerText=e.providerTitle,o.querySelector(".post__provider").setAttribute("href",e.providerURL),o.querySelector(".posts__list-item").setAttribute("data-provider",e.providerTitle),o.querySelector(".posts__list-item").setAttribute("data-idx",e.providerIdx),o.querySelector(".post__description").innerHTML=`${String(e.description).substring(0,130)}...`,o.querySelector(".post__link").setAttribute("href",e.link),o.querySelector(".btn-modal").setAttribute("data-idx",t),n.append(o)}))})(t)})).catch(console.error)},a=(e,n)=>{switch(e){case"user_token":c(n);break;case"user_profile":case"user_calendar_list":break;case"user_info":t=n.emailAddresses[0].value;document.querySelector(".userName").innerText=h(n.names[0].displayName);break;case"user_calendar_events":i(n)}},c=e=>{g(),chrome.runtime.sendMessage({message:"get_profile"}),chrome.runtime.sendMessage({message:"get_user_information"}),chrome.runtime.sendMessage({message:"get_calendar_list"}),chrome.runtime.sendMessage({message:"get_calendar_by_id"})},i=e=>{const t=document.querySelector(".calendar-list"),n=document.querySelector(".calendar-event"),r=l(e);u(r).forEach((e=>{const r=n.content.cloneNode(!0);if(r.querySelector(".event-summary").innerText=e.summary,e.hangoutLink&&(r.querySelector(".event-hangout").setAttribute("href",e.hangoutLink),r.querySelector(".event-hangout").classList.remove("d-none")),r.querySelector(".event-start-time").innerText=e.eventStartPretty,r.querySelector(".event-duration").innerText=e.eventDuration,e.attendees){const t=d(e.attendees);r.querySelector(".calendar-event-item").classList.add(t)}t.append(r)}))},d=e=>{let n;return e.forEach((e=>{e.email===t&&(n=e.responseStatus)})),n},l=e=>{const t=[];return e.items.forEach((e=>{var n;const r=(null===(o=e.originalStartTime)||void 0===o?void 0:o.dateTime)||(null===(n=e.start)||void 0===n?void 0:n.dateTime);if(e.summary&&r&&-1===e.id.indexOf("_")){var o;e.eventStartPretty=(e=>{const t=new Date(e);let n=`${t.getHours()}h`;return t.getMinutes()&&(n=`${n}${t.getMinutes()}m`),n})(r);const n=null===(o=e.end)||void 0===o?void 0:o.dateTime;e.eventDuration=`${((e,t)=>{const n=new Date(e);return(new Date(t).getTime()-n.getTime())/6e4})(r,n)}min`,t.push(e)}})),t.sort(((e,t)=>{var n,r,o,s;return new Date((null===(n=t.originalStartTime)||void 0===n?void 0:n.dateTime)||(null===(r=t.start)||void 0===r?void 0:r.dateTime))-new Date((null===(o=e.originalStartTime)||void 0===o?void 0:o.dateTime)||(null===(s=e.start)||void 0===s?void 0:s.dateTime))})),t},u=e=>m(e).sort(((e,t)=>e.startDateInMilliseconds<t.startDateInMilliseconds?-1:e.startDateInMilliseconds>t.startDateInMilliseconds?1:0)),m=e=>(e.forEach((e=>{const t=e.start.dateTime.split("T")[1].split("-")[0],n=36e5*Number(t.split(":")[0])+6e4*Number(t.split(":")[1]);e.startDateInMilliseconds=n})),e),h=e=>{try{const t=e.toLowerCase().split(" ");for(let e=0;e<t.length;e++)t[e].length>1&&(t[e]=t[e].charAt(0).toUpperCase()+t[e].substring(1));return t.join(" ")}catch(t){return console.log(t),e}},g=()=>{try{chrome.identity.getAuthToken({interactive:!1},(e=>{const t=e||!1;y();const n=t?".userstatus-auth":".userstatus-unauth";document.querySelectorAll(n).forEach((e=>{e.classList.add("d-block")})),t&&(document.querySelector("body").classList.add("is-auth"),p())}))}catch(e){console.log(e)}},y=()=>{document.querySelector(".calendar-list").textContent="",document.querySelector("body").classList.remove("is-auth");const e=document.querySelectorAll(".userstatus-auth"),t=document.querySelectorAll(".userstatus-unauth");e.forEach((e=>{e.classList.remove("d-block"),e.classList.remove("d-none")})),t.forEach((e=>{e.classList.remove("d-block"),e.classList.remove("d-none")}))},p=()=>{chrome.runtime.sendMessage({message:"get_user_information"}),chrome.runtime.sendMessage({message:"get_calendar_list"}),chrome.runtime.sendMessage({message:"get_calendar_by_id"})};chrome.storage.sync.get({role:""},(function(e){const t=e.role.split("||");o.id=t[0],o.name=t[1],s(o.id),document.querySelector(".role-title").innerText=`(${o.name})`})),(()=>{const e=new Request("https://geolocation-db.com/json/59e89620-db25-11eb-ad48-73c00c9b92a3");return fetch(e,{method:"GET"}).then((e=>e.json())).then((e=>{r=e.city.toLowerCase()})).catch(console.error)})().then((()=>{(()=>{const e=new Request(`https://resourcery.vercel.app/weather-${r}.json`);fetch(e,{method:"GET"}).then((e=>e.json())).then((e=>{const t=document.querySelector(".city-name"),n=document.querySelector(".city-temp"),o=document.querySelector(".city-sky"),s=document.querySelector(".icon-weather"),a=document.querySelector(".weather-wrapper");t.innerText=r,n.innerText=Math.round(e.main.feels_like),o.innerText=e.weather[0].description,s.setAttribute("src",`http://openweathermap.org/img/wn/${e.weather[0].icon}@2x.png`),a.classList.remove("d-none")})).catch(console.error)})(),(()=>{const e=(new Date).getHours();let t="Hello";e>5&&e<=12&&(t="Good morning"),e>12&&e<=18&&(t="Good afternoon"),e>18&&e<=23&&(t="Good night"),e>=0&&e<5&&(t="It's late"),document.querySelector(".greet").innerText=t})()})),g(),document.getElementById("contentModal").addEventListener("show.bs.modal",(function(t){const r=e[t.relatedTarget.getAttribute("data-idx")];n.innerHTML=r["content:encoded"]})),document.querySelector("#oauthButton").addEventListener("click",(function(){chrome.runtime.sendMessage({message:"get_auth_token"})})),document.querySelector("#unauthButton").addEventListener("click",(function(){chrome.identity.clearAllCachedAuthTokens((()=>{g()}))})),chrome.runtime.onMessage.addListener((function(e,t,n){"chrome-message"===e.action&&a(e.message,e.data)})),chrome.runtime.sendMessage({message:"get_profile"})}));
//# sourceMappingURL=index.b7c77cf4.js.map
